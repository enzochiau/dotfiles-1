{"mode":"editor","version":"0.73.0","windowDimensions":{"x":0,"y":0,"width":1920,"height":1080},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/taichi/blog/octopress","buffers":[{"text":"---\nlayout: post\ntitle: 'RubyのコマンドラインツールのMan Pageをつくる'\ndate: 2014-03-17 19:03\ncomments: true\ncategories: ruby\n---\n\nコマンドラインツールでは，`--help`オプションで簡単に使い方やオプションの説明を出力する．単純に使ってもらう分にはこれで足りる．ただ，さらにそのコマンドラインツールを使ってもらいたい場合には，詳細なドキュメントや使い方の例，簡単なチュートリアルをコマンドライン上で提供できるのがよい．単純に`Optparse`などでこれをやろうとすると，スペースが足りないし，ちょっとヘルプを見たいだけのユーザには邪魔になる．\n\n伝統的なUNIXコマンドは，`man`コマンドを通じてそのような詳細な情報を提供している．例えば，`man ls`と打てば，`ls`コマンドの詳細が見れる．RubyでつくったコマンドラインツールでもMan Pageを通じて，同様の情報を提供できるとよい．\n\nしかし，Rubygems.orgを通してコマンドラインツールを配信する場合，標準の`man`コマンドを通じてMan pageを提供するのは難しい．GithubのChris Wanstrath氏による[gem-man](https://github.com/defunkt/gem-man)を使えば，`gem man`コマンドを通じて標準の`man`と同様のMan Pageを簡単に提供できる．\n\nさらに，Man Pageは，[nroff](http://ja.wikipedia.org/wiki/Roff)という専用の言語で書かれており，わざわざ習得するのはめんどい．これも，[rtomayko/ronn](https://github.com/rtomayko/ronn)を使えば，MarkdownでMan pageを書いて，nroff形式に変換することができる．\n\n## TL;DR\n\n- `gem man`でrubyでつくったコマンドラインツールのMan Pageを提供する\n- [ronn](https://github.com/rtomayko/ronn)でMarkdown形式をMan Pageのnroff形式を吐き出す\n\n以下のようなものをつくる．\n\n```bash\n$ gem man your_app\n\nNAME\n    your_app - Sample of gem-man and ronn\n\nSYNOPSIS\n    your_app [options]\n\nDESCRIPTION\n    your_app is a simple command-line tool for ...\n\nOPTIONS\n    -h, --help\n      Show help page.\netc...      \n```\n\n## Install\n\nGemとして`gem-man`と`ronn`をインストールする．\n\n```bash\n$ gem install gem-man ronn\n```\n\nRubygemsとして配布する場合は，gemspecに以下を追記する．\n\n```ruby\n# your_app.gemspec\nspec.add_dependency \"gem-man\"\nspec.add_development_dependency \"ronn\"\n```\n\nMan Pageのソースは，プロジェクトのルートの`man`ディレクトリに配置し，ファイル名は`your_app.1.ronn`とする．\n\n```bash\n$ mkdir man\n$ touch man/your_app.1.ronn\n```\n\n`.1`というファイル名は必須でMan Pageのセクション番号を示す．\n\n## ronnでMan Pageをつくる\n\nronnを使えば，Man PageをMarkdown形式で書き，nroff形式で吐き出すことができる．例えば，以下のように書く．\n\n```\nyour_app(1) - Sample of gem-man and ronn\n====\n\n## SYNOPSIS\n\n`your_app` [options]\n\n## DESCRIPTION\n\n**your_app** is a simple command-line tool for ...\n\n## OPTIONS\n\n  * -h, --help\n      Show help page.\n\n## Exmaple\n...\n```\n\n`##`でセクションの始まり，`*`でリストなど，普段`README.md`などで書いてるのと同じ感じで作成できる．また，`<>`で囲めばリンクとなり，`man/index.txt`を準備すれば，他のMan Pageにリンクを貼ることもできる．\n\n後は，以下のコマンドでnroff形式で吐き出すだけ．\n\n```bash\n$ ronn man/your_app.1.ronn\nroff: man/your_app.1\nhtml: man/your_app.1.html                                     \n```\n\n同時にHTML形式も吐き出される（例えば，ronnだと[こんな感じ](http://rtomayko.github.io/ronn/ronn.1.html)のページが生成される）．生成結果は，標準の`man`を使ってプレビューできる．\n\n```\n$ man man/your_app.1\n```\n\n## gem-manを使う\n\n後は，上で作成したmanディレクトリを一緒にgemとして配布すれば，ユーザは以下のコマンドで作成したMan Pageを表示できるようになる．\n\n```\n$ gem man your_app\n```\n\nUNIXの他のコマンドと同様に扱いたい場合は，以下のようなAliasを設定すればよい．\n\n```bash\n$ alias man='gem man -s'\n```\n\nMan Pageがあれば，わざわざブラウザを立ち上げることなく，詳細のドキュメントをユーザに提示でき，より親切なコマンドラインツールをつくれる．\n\n## 参考\n\n- [Build Awesome Command-Line Applications in Ruby](http://pragprog.com/book/dccar/build-awesome-command-line-applications-in-ruby)\n- [tcnksm/rbdock](https://github.com/tcnksm/rbdock)\n\n\n\n\n\n\n","markers":{"markers":{"1":{"id":1,"range":[[64,34],[64,34]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":132,"goalBufferRange":null,"preserveFolds":true},"deserializer":"Marker"},"42":{"id":42,"range":[[19,3],[19,7]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"43":{"id":43,"range":[[27,37],[27,41]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"44":{"id":44,"range":[[46,22],[46,26]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"45":{"id":45,"range":[[60,2],[60,7]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"46":{"id":46,"range":[[71,36],[71,40]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"47":{"id":47,"range":[[87,3],[87,10]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"48":{"id":48,"range":[[96,2],[96,6]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"49":{"id":49,"range":[[97,0],[97,4]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"50":{"id":50,"range":[[19,3],[19,7]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"51":{"id":51,"range":[[27,37],[27,41]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"52":{"id":52,"range":[[46,22],[46,26]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"53":{"id":53,"range":[[60,2],[60,7]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"54":{"id":54,"range":[[71,36],[71,40]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"55":{"id":55,"range":[[87,3],[87,10]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"56":{"id":56,"range":[[96,2],[96,6]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"},"57":{"id":57,"range":[[97,0],[97,4]],"tailed":true,"reversed":false,"valid":true,"invalidate":"inside","persistent":true,"properties":{"replicate":false},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/taichi/blog/octopress/source/_posts/2014-03-17-gem-man.markdown","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"023361c911fb3b7efb3946087f7a89371b0ff66d","deserializer":"TextBuffer"},{"text":"# Your keymap\n#\n# Atom keymaps work similarly to stylesheets. Just as stylesheets use selectors\n# to apply styles to elements, Atom keymaps use selectors to associate\n# keystrokes with events in specific contexts.\n#\n# You can create a new keybinding in this file by typing \"key\" and then hitting\n# tab.\n#\n# Here's an example taken from Atom's built-in keymap:\n#\n# '.editor':\n#   'enter': 'editor:newline'\n#\n# 'body':\n#   'ctrl-P': 'core:move-up'\n#   'ctrl-p': 'core:move-down'\n#\n\n'.editor':\n  # Save\n  'ctrl-x ctrl-s': 'core:save'\n\n'body':\n\n  # Split pane\n  'ctrl-x 0': 'pane:close'\n  'ctrl-x 2': 'pane:split-down'\n  'ctrl-x 3': 'pane:split-right'\n\n  # Move pane\n  'ctrl-r ctrl-r': 'pane:show-next-item'\n","markers":{"markers":{"1":{"id":1,"range":[[14,9],[14,9]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":153,"goalBufferRange":null,"preserveFolds":true},"deserializer":"Marker"},"11":{"id":11,"range":[[31,30],[31,30]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":225,"goalBufferRange":null,"preserveFolds":true},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[21,30],[21,30]],"newRange":[[21,30],[22,0]],"oldText":"","newText":"\n","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[22,0],[22,0]],"newRange":[[22,0],[22,2]],"oldText":"","newText":"  ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[22,2],[22,2]],"newRange":[[22,2],[23,0]],"oldText":"","newText":"\n","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[23,0],[23,0]],"newRange":[[23,0],[23,2]],"oldText":"","newText":"  ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[22,0],[22,2]],"newRange":[[22,0],[22,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[23,0],[23,2]],"newRange":[[23,0],[23,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":11,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":11,"oldParams":{"range":[[23,0],[23,0]]},"newParams":{"range":[[22,0],[23,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[22,0],[23,0]],"newRange":[[22,0],[22,0]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":11,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":11,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":11,"oldParams":{"range":[[22,0],[22,0]]},"newParams":{"range":[[21,30],[22,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[21,30],[22,0]],"newRange":[[21,30],[21,30]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":11,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[21,30],[21,30]],"newRange":[[21,30],[22,0]],"oldText":"","newText":"\n","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[22,0],[22,0]],"newRange":[[22,0],[22,2]],"oldText":"","newText":"  ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[22,2],[22,2]],"newRange":[[22,2],[23,0]],"oldText":"","newText":"\n","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[23,0],[23,0]],"newRange":[[23,0],[23,2]],"oldText":"","newText":"  ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[22,0],[22,2]],"newRange":[[22,0],[22,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[23,0],[23,2]],"newRange":[[23,0],[23,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":11,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":11,"oldParams":{"range":[[23,0],[23,0]]},"newParams":{"range":[[22,0],[23,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[22,0],[23,0]],"newRange":[[22,0],[22,0]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":11,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":11,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":11,"oldParams":{"range":[[22,0],[22,0]]},"newParams":{"range":[[21,30],[22,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[21,30],[22,0]],"newRange":[[21,30],[21,30]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":11,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/taichi/.atom/keymap.cson","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"45a6635b03a90ea0a3ae2bdefdc07201d855cf10","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"children":[{"items":[{"id":225,"softTabs":true,"scrollTop":0,"scrollLeft":0,"displayBuffer":{"id":224,"softWrap":false,"editorWidthInChars":94,"tokenizedBuffer":{"bufferPath":"/Users/taichi/.atom/keymap.cson","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/taichi/.atom/keymap.cson","focused":false,"active":false,"deserializer":"Pane"},{"items":[{"id":132,"softTabs":true,"scrollTop":1031,"scrollLeft":0,"displayBuffer":{"id":133,"softWrap":false,"editorWidthInChars":84,"tokenizedBuffer":{"bufferPath":"/Users/taichi/blog/octopress/source/_posts/2014-03-17-gem-man.markdown","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"deserializer":"SettingsView","version":2,"activePanelName":"Keybindings","uri":"atom://config"},{"id":153,"softTabs":true,"scrollTop":0,"scrollLeft":0,"displayBuffer":{"id":154,"softWrap":false,"editorWidthInChars":84,"tokenizedBuffer":{"bufferPath":"/Users/taichi/.atom/keymap.cson","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"atom://config","focused":false,"active":true,"deserializer":"Pane"}],"orientation":"horizontal","deserializer":"PaneAxis"},"deserializer":"PaneContainer"},"fullScreen":true,"deserializer":"Workspace"},"packageStates":{"fuzzy-finder":{"/Users/taichi/.atom/keymap.cson":1395136458602,"/Users/taichi/blog/octopress/source/_posts/2014-03-17-gem-man.markdown":1395136457922},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":148979},"tree-view":{"directoryExpansionStates":{},"hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}}}